# RCompiler Semantic-1 测试评测脚本

## 概述

`evaluate_tests.py` 是一个自动评测脚本，用于评测 RCompiler-Testcases/semantic-1 目录下的所有语义分析测试点。

## 功能特性

- 自动查找所有 `.rx` 测试文件
- 从文件注释中提取期望的 Verdict（Success/Pass = 0, Fail = -1）
- 运行编译器分析每个测试文件（15秒超时保护）
- 比较期望值和实际值
- 直观地展示评测结果
- 生成详细的 Markdown 格式测试报告
- 按期望结果分类的统计分析
- 按测试模块分组的统计信息
- 完整的执行时间统计和性能指标

## 使用方法

### 前提条件

1. 确保项目已经编译：
   ```bash
   cd build
   make
   cd ..
   ```

2. 确保测试目录存在：
   ```
   RCompiler-Testcases/semantic-1/
   ```

### 运行评测

```bash
python3 evaluate_tests.py
```

或者直接运行：

```bash
./evaluate_tests.py
```

## 输出说明

### 控制台输出

#### 汇总信息
- 总测试数
- 通过数量和百分比
- 失败数量和百分比
- 错误数量和百分比
- 执行时间

#### 按期望结果分类统计
- 期望结果为 0 的测试用例分布
- 期望结果为 -1 的测试用例分布

#### 按模块分组统计
- 各模块的测试数量、通过率等指标
- 按通过率排序显示前10个模块

#### 详细结果表格
| 测试名称 | 期望 | 实际 | 状态 | 文件路径 |
|---------|------|------|------|----------|

#### 状态说明
- ✓ PASS: 期望值与实际值匹配
- ✗ FAIL: 期望值与实际值不匹配
- ⚠ ERROR: 编译器运行异常或超时

#### 失败/错误详情
对于失败和错误的测试，脚本会显示详细原因：
- 无法提取 Verdict
- 编译器运行异常或超时

### 测试报告文件

脚本会自动生成详细的 Markdown 格式报告文件，文件名格式为 `test_report_YYYYMMDD_HHMMSS.md`，包含：

#### 报告内容
1. **总体统计**：总测试数、通过率、失败率、错误率
2. **按期望结果分类统计**：
   - 期望为 0 的测试用例中，实际结果为 0、-1、-2 的分布
   - 期望为 -1 的测试用例中，实际结果为 0、-1、-2 的分布
3. **按测试模块分组统计**：各模块的详细统计信息
4. **详细测试结果**：所有测试的完整结果列表
5. **失败/错误测试详情**：每个失败测试的详细分析

#### 报告示例
```markdown
## 总体统计

| 指标 | 数量 | 百分比 |
|------|------|--------|
| 总测试数 | 222 | 100.0% |
| 通过 | 58 | 26.1% |
| 失败 | 132 | 59.5% |
| 错误 | 32 | 14.4% |

## 按期望结果分类统计

### 期望结果为 0 的测试用例

| 实际结果 | 数量 | 占比 |
|----------|------|------|
| 0 (正确) | 45 | 81.8% |
| -1 (错误) | 8 | 14.5% |
| -2 (异常) | 2 | 3.6% |
```

## 测试结果示例

```
评测结果汇总
================================================================================
总测试数: 222
通过: 58
失败: 132
错误: 32
通过率: 26.1%

详细结果
================================================================================
测试名称              期望     实际     状态     文件路径
--------------------------------------------------------------------------------
array1                0        0        ✓ PASS   RCompiler-Testcases/semantic-1/src/array1/array1.rx
array2                0        0        ✓ PASS   RCompiler-Testcases/semantic-1/src/array2/array2.rx
basic3                -1       0        ✗ FAIL   RCompiler-Testcases/semantic-1/src/basic3/basic3.rx
```

## 注意事项

1. 脚本会为每个测试文件设置 15 秒的超时限制
2. 编译器输出可能包含调试信息，脚本会自动提取最后一行的有效数字
3. 支持的 Verdict 值：Success, Pass（都表示 0），Fail（表示 -1）
4. 报告文件会自动保存到当前目录，文件名包含时间戳
5. 脚本会记录总执行时间，便于性能分析

## 故障排除

### 编译器不存在
如果看到错误 "编译器不存在"，请先编译项目：
```bash
cd build && make
```

### 测试目录不存在
如果看到错误 "测试目录不存在"，请确保 RCompiler-Testcases 目录在正确位置

### 权限问题
如果无法运行脚本，请添加执行权限：
```bash
chmod +x evaluate_tests.py